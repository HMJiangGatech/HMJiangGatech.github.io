<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Hack WiC Leaderboard :: Haoming Jiang — Machine Learning; Optimization; NLP</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="WiC dataset is to identify the intended meaning of words. Each instance in WiC has a target word w, either a verb or a noun, for which two contexts are provided. Each of these contexts triggers a specific meaning of w. The task is to identify if the occurrences of w in the two contexts correspond to the same meaning or not. link Leaderboard
 WiC is a rather small dataset and can be somwhow hacked." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://hmjianggatech.github.io/notes/hack_wic/" />




<link rel="stylesheet" href="https://hmjianggatech.github.io/assets/style.css">



<link rel="stylesheet" href="https://hmjianggatech.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hmjianggatech.github.io/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://hmjianggatech.github.io/favicon.ico">



<meta name="twitter:card" content="summary" />

  <meta name="twitter:site" content="" />

<meta name="twitter:creator" content="" />


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Hack WiC Leaderboard :: Haoming Jiang">
<meta property="og:description" content="WiC dataset is to identify the intended meaning of words. Each instance in WiC has a target word w, either a verb or a noun, for which two contexts are provided. Each of these contexts triggers a specific meaning of w. The task is to identify if the occurrences of w in the two contexts correspond to the same meaning or not. link Leaderboard
 WiC is a rather small dataset and can be somwhow hacked." />
<meta property="og:url" content="https://hmjianggatech.github.io/notes/hack_wic/" />
<meta property="og:site_name" content="Hack WiC Leaderboard" />

  
    <meta property="og:image" content="https://hmjianggatech.github.io/favicon.ico">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2020-05-16 23:50:07 -0400 EDT" />












</head>
<body class="">


<div class="container full headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Haoming Jiang
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">About Me</a></li>
        
      
        
          <li><a href="/research">Research</a></li>
        
      
        
          <li><a href="/projects">Projects</a></li>
        
      
        
          <li><a href="/news">News</a></li>
        
      
        
          <li><a href="/notes">Notes</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">Show more ▾</li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/others">Others</a></li>
              
            
              
                <li><a href="/gallery">Gallery</a></li>
              
            
          </ul>
        </ul>
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">About Me</a></li>
      
    
      
        <li><a href="/research">Research</a></li>
      
    
      
        <li><a href="/projects">Projects</a></li>
      
    
      
        <li><a href="/news">News</a></li>
      
    
      
        <li><a href="/notes">Notes</a></li>
      
    
      
        <li><a href="/others">Others</a></li>
      
    
      
        <li><a href="/gallery">Gallery</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://hmjianggatech.github.io/notes/hack_wic/">Hack WiC Leaderboard</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2020-05-16
    </span>
    
    
  </div>

  

  

  <div class="post-content"><div>
        <blockquote>
<p>WiC dataset is to identify the intended meaning of words. Each instance in WiC has a target word w, either a verb or a noun, for which two contexts are provided. Each of these contexts triggers a specific meaning of w. The task is to identify if the occurrences of w in the two contexts correspond to the same meaning or not. <a href="https://pilehvar.github.io/wic/">link</a> <a href="https://competitions.codalab.org/competitions/20010">Leaderboard</a></p>
</blockquote>
<p>WiC is a rather small dataset and can be somwhow hacked.</p>
<p>In this note, I use superglue version of data: <a href="https://dl.fbaipublicfiles.com/glue/superglue/data/v2/WiC.zip">WiC.zip</a></p>
<h2 id="step-1-hack-using-wordnet">Step 1: Hack using wordnet<a href="#step-1-hack-using-wordnet" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Lots of sentences are just from WordNet.</p>
<p>By applying the following rule, you will get a pretty good position in the leaderboard:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wordnetmatch</span>(e):
    s1 <span style="color:#f92672">=</span> e[<span style="color:#e6db74">&#39;sentence1&#39;</span>]<span style="color:#f92672">.</span>lower()
    s2 <span style="color:#f92672">=</span> e[<span style="color:#e6db74">&#39;sentence2&#39;</span>]<span style="color:#f92672">.</span>lower()
    w <span style="color:#f92672">=</span> e[<span style="color:#e6db74">&#39;word&#39;</span>]
    hit1 <span style="color:#f92672">=</span> hit2 <span style="color:#f92672">=</span> None
    synsets <span style="color:#f92672">=</span> wn<span style="color:#f92672">.</span>synsets(w)
    <span style="color:#66d9ef">for</span> i,s <span style="color:#f92672">in</span> enumerate(synsets):
        <span style="color:#66d9ef">for</span> ex <span style="color:#f92672">in</span> s<span style="color:#f92672">.</span>examples():
            <span style="color:#66d9ef">if</span> edit_distance(s1,ex<span style="color:#f92672">.</span>lower()) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">8</span>:
                hit1<span style="color:#f92672">=</span>i
            <span style="color:#66d9ef">if</span> edit_distance(s2,ex<span style="color:#f92672">.</span>lower()) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">8</span>:
                hit2<span style="color:#f92672">=</span>i
    <span style="color:#66d9ef">if</span> hit1<span style="color:#f92672">==</span>hit2:
        <span style="color:#66d9ef">return</span> True
    <span style="color:#66d9ef">elif</span> hit1 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None <span style="color:#f92672">and</span> hit2 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None: 
        <span style="color:#66d9ef">if</span> edit_distance(synsets[hit1]<span style="color:#f92672">.</span>definition(), synsets[hit2]<span style="color:#f92672">.</span>definition()) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>:
            <span style="color:#66d9ef">return</span> True
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> False

    <span style="color:#66d9ef">assert</span> False
</code></pre></div><p>For training data:</p>
<ul>
<li>Accuracy:  0.928</li>
<li>Cover rate:  0.634</li>
</ul>
<p>For validation data:</p>
<ul>
<li>Accuracy:  0.940</li>
<li>Cover rate:  0.649</li>
</ul>
<p>Let&rsquo;s try on leaderboard!</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Human Baseline</td>
<td>80.0</td>
</tr>
<tr>
<td>T5</td>
<td>76.9</td>
</tr>
<tr>
<td><strong>&ndash;WordNet Hack&ndash;</strong></td>
<td><strong>&ndash;73.6&ndash;</strong></td>
</tr>
<tr>
<td>NEZHA-Large</td>
<td>72.7</td>
</tr>
<tr>
<td>RoBERTa-mtl-adv</td>
<td>72.1</td>
</tr>
<tr>
<td>RoBERTa</td>
<td>69.9</td>
</tr>
<tr>
<td>BERT</td>
<td>69.6</td>
</tr>
</tbody>
</table>
<h2 id="step-2-train-over-partially-labeled-data">Step 2: Train over partially labeled data.<a href="#step-2-train-over-partially-labeled-data" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Fine-tune Roberta Model on labeled training data, matched dev data, matched test data.
Select the best checkpoint according to dev data.</p>
<p>Let&rsquo;s try on leaderboard!</p>
<p><strong>Surpass Human Performance!!!!!!</strong></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>&ndash;WordNet Hackv2&ndash;</strong></td>
<td><strong>&ndash;84.1&ndash;</strong></td>
</tr>
<tr>
<td>Human Baseline</td>
<td>80.0</td>
</tr>
<tr>
<td>T5</td>
<td>76.9</td>
</tr>
<tr>
<td><strong>&ndash;WordNet Hackv1&ndash;</strong></td>
<td><strong>&ndash;73.6&ndash;</strong></td>
</tr>
<tr>
<td>NEZHA-Large</td>
<td>72.7</td>
</tr>
<tr>
<td>RoBERTa-mtl-adv</td>
<td>72.1</td>
</tr>
<tr>
<td>RoBERTa</td>
<td>69.9</td>
</tr>
<tr>
<td>BERT</td>
<td>69.6</td>
</tr>
</tbody>
</table>
<h2 id="utils-map-v11-ids-to-v10">Utils: Map v1.1 ids to v1.0<a href="#utils-map-v11-ids-to-v10" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> json

data_0 <span style="color:#f92672">=</span> []
data_1 <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;test.data.txt&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
    <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
        l <span style="color:#f92672">=</span> l<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>)
        l <span style="color:#f92672">=</span> [i<span style="color:#f92672">.</span>rstrip() <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> l]
        _e <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;word&#39;</span>:l[<span style="color:#ae81ff">0</span>]}
        _e[<span style="color:#e6db74">&#39;sentence1&#39;</span>] <span style="color:#f92672">=</span> l[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;—&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;`&#39;</span>,<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>)
        _e[<span style="color:#e6db74">&#39;sentence2&#39;</span>] <span style="color:#f92672">=</span> l[<span style="color:#ae81ff">4</span>]<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;—&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;`&#39;</span>,<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>)
        data_0<span style="color:#f92672">.</span>append(_e)

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;test.jsonl&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
    <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
        _e <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(l)
        _e[<span style="color:#e6db74">&#39;sentence1&#39;</span>] <span style="color:#f92672">=</span> _e[<span style="color:#e6db74">&#39;sentence1&#39;</span>]<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;—&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)
        _e[<span style="color:#e6db74">&#39;sentence2&#39;</span>] <span style="color:#f92672">=</span> _e[<span style="color:#e6db74">&#39;sentence2&#39;</span>]<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39; &#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;—&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)
        data_1<span style="color:#f92672">.</span>append(_e)

<span style="color:#66d9ef">print</span>(data_0[<span style="color:#ae81ff">0</span>])
<span style="color:#66d9ef">print</span>(data_1[<span style="color:#ae81ff">0</span>])


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">findid0</span>(x):
    count_id <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> i,e <span style="color:#f92672">in</span> enumerate(data_0):
        <span style="color:#66d9ef">if</span> e[<span style="color:#e6db74">&#39;word&#39;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#39;word&#39;</span>] <span style="color:#f92672">and</span> \
           e[<span style="color:#e6db74">&#39;sentence1&#39;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#39;sentence1&#39;</span>] <span style="color:#f92672">and</span> \
           e[<span style="color:#e6db74">&#39;sentence2&#39;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#39;sentence2&#39;</span>]:
           <span style="color:#66d9ef">return</span> i 
        <span style="color:#66d9ef">if</span> e[<span style="color:#e6db74">&#39;word&#39;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#39;word&#39;</span>]:
            count_id<span style="color:#f92672">.</span>append(i)
    <span style="color:#66d9ef">if</span> len(count_id) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
        <span style="color:#66d9ef">return</span> count_id[<span style="color:#ae81ff">0</span>]
    
    <span style="color:#66d9ef">print</span>(x)
    <span style="color:#66d9ef">for</span> id <span style="color:#f92672">in</span> count_id:
        <span style="color:#66d9ef">print</span>(data_0[id])
        <span style="color:#66d9ef">print</span>(data_0[id][<span style="color:#e6db74">&#39;sentence1&#39;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#39;sentence1&#39;</span>],data_0[id][<span style="color:#e6db74">&#39;sentence2&#39;</span>] <span style="color:#f92672">==</span> x[<span style="color:#e6db74">&#39;sentence2&#39;</span>])
    <span style="color:#f92672">import</span> ipdb; ipdb<span style="color:#f92672">.</span>set_trace()

map1_to_0 <span style="color:#f92672">=</span> [findid0(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> data_1]

<span style="color:#f92672">import</span> copy 
_c <span style="color:#f92672">=</span> copy<span style="color:#f92672">.</span>deepcopy(map1_to_0)
_c<span style="color:#f92672">.</span>sort()
<span style="color:#66d9ef">for</span> i,j <span style="color:#f92672">in</span> zip(_c, range(len(_c))):
    <span style="color:#66d9ef">assert</span> i<span style="color:#f92672">==</span>j

results <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>len(map1_to_0)
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;hackwic2/WiC.jsonl&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
    <span style="color:#66d9ef">for</span> l <span style="color:#f92672">in</span> f<span style="color:#f92672">.</span>readlines():
        _e <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(l)
        id1 <span style="color:#f92672">=</span> _e[<span style="color:#e6db74">&#39;idx&#39;</span>]
        id2 <span style="color:#f92672">=</span> map1_to_0[id1]
        <span style="color:#66d9ef">if</span> _e[<span style="color:#e6db74">&#39;label&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;true&#39;</span>:
            results[id2]<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;T&#39;</span>
        <span style="color:#66d9ef">else</span>:
            results[id2]<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;F&#39;</span>
            
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;output.txt&#39;</span>,<span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
    <span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> results:
        f<span style="color:#f92672">.</span>write(r<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div>
      </div></div>

  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2021 Powered by <a href="http://gohugo.io">Hugo</a></span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://hmjianggatech.github.io/assets/main.js"></script>
<script src="https://hmjianggatech.github.io/assets/prism.js"></script>


<script src="https://www.w3counter.com/tracker.js?id=129052"></script>




  
</div>

</body>
</html>
